let player;
let map;
let walls, doors, keys, winZone;
let wallsImg, keyImg, doorImg;

let doorsRemoved = false;
let won = false;
const movementSpeed = 5;

let mazeTilemap = ["================================================================================.",
"=....=...=.............=.............=....=....................................=.",
"=....=...=.............=.............=....=....................................=.",
"=....=...=.............=......=......=....=....................................=.",
"=....=...=...======....=......=......=....=....................................=.",
"=....=...=...=....=....=......=......=....=....................................dw",
"=....=...=...=....=....=......=......=....=....===========.....................dw",
"=........=...=....=....=......=......=....=..............=.....................dw",
"=........=...=....=....=....k.=......=....=..............=.....................dw",
"=........=...======....========......=....=..............=.....................=.",
"=....=...=...........................=....=..............=.....................=.",
"=....=...=...........................=....=..............=.....................=.",
"=....=...=...........................=....=..............=.....................=.",
"=....=...==========....===============....================....==================.",
"=....=.........................................................................=.",
"=....=.........................................................................=.",
"=....=........................................................................k=.",
"=....=.........................................................................=.",
"=....=.........................................................................=.",
"=....=...========....=================....=================...==================.",
"=....=...=......=....=....................................=...=................=.",
"=....=...=......=....=....................................=...=................=.",
"=....=...=......=....=....................................=...=................=.",
"=........=......=....=....===========================.....=...=................=.",
"=........=......=....=....=.........................=.....=...=................=.",
"=........=......=....=....=.........................=.....=...=................=.",
"=....=...=......=....=....=.........................=.....=...=................=.",
"=....=...=......=....=....=.........................=.....=...=................=.",
"=....=...=......=....=....=.........................=.....=...=................=.",
"=....=...=......=....=....=.........................=.....=...=................=.",
"=....=...========....=....===========================.....=...=................=.",
"=....=...............=..............=.....................=...=................=.",
"=....=...............=..............=.....................=...=................=.",
"=....=...............=..............=.....................=...=................=.",
"=====================================....==================...==================.",
"=.........................................................=....................=.",
"=.........................................................=....................=.",
"=.........................................................=....................=.",
"=k........................................................=...................k=.",
"================================================================================."];

function preload(){
	wallsImg = loadImage("Maze Game Assets/wallTile.png");
	keyImg = loadImage("Maze Game Assets/key.png");
	doorImg = loadImage("Maze Game Assets/door.png");
}

function setup() {
	new Canvas(700, 700);
	displayMode(CENTERED);
	player = new Sprite(80, 80, 15, 15);
	player.rotationLock = true;

	walls = new Group();
	walls.width = 40;
	walls.height = 40;
	walls.tile = "=";
	walls.image = wallsImg;
	walls.image.scale = 5;
	walls.collider = "s";

	winZone = new Group();
	winZone.height = 40;
	winZone.width = 40;
	winZone.opacity = 0;
	winZone.collider = "n";
	winZone.tile = "w";

	camera.zoom = 1.2;
	camera.x = player.x;
	camera.y = player.y;

	doors = new Group();
	doors.tile = "d";
	doors.image = doorImg;
	doors.image.scale = 5;
	doors.collider = "s";
	doors.width = 40;
	doors.height = 45;

	keys = new Group();
	keys.width = 10;
	keys.height = 10;
	keys.img = keyImg;
	keys.img.scale = 1.5;
	keys.tile = "k";
	keys.collider = "s";

	map = new Tiles(mazeTilemap, 20, 20, 40, 40);
}

function draw() {
	background('black');

	if(!won){
		camera.x = player.x;
		camera.y = player.y;
		if(kb.pressing("s")){
			player.direction = 90;
			player.speed = movementSpeed;
		}
		if(kb.pressing("w")){
			player.direction = -90;
			player.speed = movementSpeed;
		}
		if(kb.pressing("d")){
			player.direction = 0;
			player.speed = movementSpeed;
		}
		if(kb.pressing("a")){
			player.direction = 180;
			player.speed = movementSpeed;
		}
		if(!kb.pressing("s") && !kb.pressing("d") && !kb.pressing("a") && !kb.pressing("w")){
			player.speed = 0;
		}
	
		for(let key of keys){
			if(keys.length > 0){
				if(player.collides(key)){
					key.remove();
				}
			}
		}
	
		if(!doorsRemoved && keys.length == 0){
			let temp = doors.length;
			for(let i = 0; i < temp; i++){
				doors[0].remove();
			}
			doorsRemoved = true;
		}
	
		if(player.overlapping(winZone)){
			won = true;
		}
	}
	else{
		player.speed = 0;
		textAlign("center");
		textSize(32);
		fill(255);
		text("Win", width/2, height/2 - 35);
	}
}
